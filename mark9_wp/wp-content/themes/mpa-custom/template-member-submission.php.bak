<?php
/**
 * Template Name: Member Submission Form
 */
get_header();
?>

<style>
.submission-form-container {
    max-width: 800px;
    margin: 60px auto;
    padding: 40px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.submission-form-container h1 {
    text-align: center;
    margin-bottom: 10px;
}
.submission-form-container .intro-text {
    text-align: center;
    color: #666;
    margin-bottom: 40px;
}
.form-group {
    margin-bottom: 25px;
}
.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
}
.form-group .required {
    color: #e74c3c;
}
.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="url"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 15px;
}
.form-group textarea {
    min-height: 120px;
}
.form-group small {
    display: block;
    margin-top: 5px;
    color: #888;
    font-size: 13px;
}
.submit-btn {
    width: 100%;
    padding: 15px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}
.submit-btn:hover {
    background: #2980b9;
}
.alert {
    padding: 15px 20px;
    border-radius: 6px;
    margin-bottom: 25px;
}
.alert-success {
    background: #d4edda;
    color: #155724;
}
.alert-error {
    background: #f8d7da;
    color: #721c24;
}
</style>

<div class="submission-form-container">
    <h1>üöÄ Join MPA - Member Application</h1>
    <p class="intro-text">Submit your company information to become a member</p>

    <div id="formMessage"></div>

    <form id="memberSubmissionForm" enctype="multipart/form-data">
        <div class="form-group">
            <label>Company Name <span class="required">*</span></label>
            <input type="text" name="company_name" required>
        </div>

        <div class="form-group">
            <label>Company Description <span class="required">*</span></label>
            <textarea name="company_description" required></textarea>
            <small>Brief description of your company (100-200 words)</small>
        </div>

        <div class="form-group">
            <label>Company Website <span class="required">*</span></label>
            <input type="url" name="company_website" placeholder="https://" required>
        </div>

        <div class="form-group">
            <label>Company Logo</label>
            <input type="file" name="company_logo" accept="image/*">
            <small>PNG or JPG, max 2MB. Square logo preferred</small>
        </div>

        <div class="form-group">
            <label>Primary Category <span class="required">*</span></label>
            <select name="primary_category" required>
                <option value="">Select Category</option>
                <option value="Plan & Construct">Plan & Construct</option>
                <option value="Market & Transact">Market & Transact</option>
                <option value="Operate & Manage">Operate & Manage</option>
                <option value="Reinvest, Report & Regenerate">Reinvest, Report & Regenerate</option>
            </select>
        </div>

        <div class="form-group">
            <label>Subcategory / Focus Area</label>
            <input type="text" name="subcategory" placeholder="e.g., IoT, Marketplaces, BIM">
        </div>

        <div class="form-group">
            <label>Contact Person Name <span class="required">*</span></label>
            <input type="text" name="contact_name" required>
        </div>

        <div class="form-group">
            <label>Contact Email <span class="required">*</span></label>
            <input type="email" name="contact_email" required>
        </div>

        <div class="form-group">
            <label>Contact Phone</label>
            <input type="text" name="contact_phone" placeholder="+60">
        </div>

        <div class="form-group">
            <label>LinkedIn Profile</label>
            <input type="url" name="linkedin" placeholder="https://linkedin.com/in/">
        </div>

        <div class="form-group">
            <label>Additional Information</label>
            <textarea name="additional_info" rows="4"></textarea>
        </div>

        <button type="submit" class="submit-btn">Submit Application</button>
    </form>
</div>

<script>
document.getElementById('memberSubmissionForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = this.querySelector('.submit-btn');
    const messageDiv = document.getElementById('formMessage');
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    messageDiv.innerHTML = '';
    
    const formData = new FormData(this);
    formData.append('action', 'submit_member_application');
    formData.append('nonce', '<?php echo wp_create_nonce('member_submission_nonce'); ?>');
    
    try {
        const response = await fetch('<?php echo admin_url('admin-ajax.php'); ?>', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            messageDiv.innerHTML = '<div class="alert alert-success">‚úÖ ' + result.data.message + '</div>';
            this.reset();
        } else {
            messageDiv.innerHTML = '<div class="alert alert-error">‚ùå ' + result.data.message + '</div>';
        }
    } catch (error) {
        messageDiv.innerHTML = '<div class="alert alert-error">‚ùå An error occurred. Please try again.</div>';
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
});
</script>

<?php get_footer(); ?>

